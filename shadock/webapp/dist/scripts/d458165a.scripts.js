!function(){"use strict";function a(a){return a("/user/:uid",{},{is_authenticated:{url:"/user/logged",method:"GET",isArray:!1,cache:!1},authenticate:{url:"/user/bind",method:"POST",isArray:!1,cache:!1},logout:{url:"/user/logout",method:"GET",isArray:!1,cache:!1}})}function b(a){return a("/search",{},{search:{url:"/search",method:"GET",isArray:!1,cache:!1}})}function c(a){return a("/container/:id",{},{query_all:{url:"/container/all",method:"GET",isArray:!0,cache:!1},create_new:{url:"/container/new",method:"POST",isArray:!1,cache:!1},latest:{url:"/container/latest",method:"GET",isArray:!0,cache:!1},search:{url:"/container/search",method:"POST",isArray:!0,cache:!1},manifest:{url:"/container/manifest/:id",method:"POST",isArray:!1,cache:!1},tags:{url:"/container/tags/:id",method:"POST",isArray:!1,cache:!1},dockerFile:{url:"/container/dockerfile/:id",method:"POST",isArray:!1,cache:!1}})}function d(a){return a("/config")}a.$inject=["$resource"],b.$inject=["$resource"],c.$inject=["$resource"],d.$inject=["$resource"],angular.module("bioshadock.resources",["ngResource"]).factory("User",a).factory("Container",c).factory("Config",d).factory("Search",b)}();var app=angular.module("bioshadock",["bioshadock.resources","ngSanitize","ngCookies","ngRoute","ui.utils","ui.bootstrap","datatables","ui.codemirror","xeditable"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/welcome.html",controller:"welcomeCtrl"}).when("/search",{templateUrl:"views/search.html",controller:"searchCtrl"}).when("/users",{templateUrl:"views/users.html",controller:"usersCtrl"}).when("/containers",{templateUrl:"views/containers.html",controller:"containersCtrl"}).when("/my/containers",{templateUrl:"views/mycontainers.html",controller:"mycontainersCtrl"}).when("/all/containers",{templateUrl:"views/mycontainers.html",controller:"allcontainersCtrl"}).when("/my/new",{templateUrl:"views/newcontainer.html",controller:"newcontainerCtrl"}).when("/container/:path*",{templateUrl:"views/container.html",controller:"containerCtrl"}).when("/dockerfile/:path*",{templateUrl:"views/dockerfile.html",controller:"containerDockerFileCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"loginCtrl"}).when("/user/:id",{templateUrl:"views/user.html",controller:"usermngtCtrl"})}]).factory("authInterceptor",["$rootScope","$q","$window",function(a,b,c){return{request:function(a){return a.headers=a.headers||{},c.sessionStorage.token&&(a.headers.Authorization="Bearer "+c.sessionStorage.token),a},response:function(a){return 401===a.status?void location.replace("#/login"):a||b.when(a)},responseError:function(a){return 401==a.status&&location.replace("#/login"),b.reject(a)}}}]).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]).controller("welcomeCtrl",["$scope","$route","Config",function(a,b,c){c.get().$promise.then(function(b){a.registry=b.registry,a.service=b.service,a.issuer=b.issuer})}]).controller("usersCtrl",["$scope","$route","User",function(a,b,c){c.query({},function(b){a.users=b}),a.change_role=function(a){a.$save({uid:a.id})}}]).controller("searchCtrl",["$scope","$route","$routeParams","Search",function(a,b,c,d){d.search({q:decodeURIComponent(c.q)},function(b){a.hits=b.hits})}]).controller("newcontainerCtrl",["$scope","$route","$routeParams","$http","Container","Auth",function(a,b,c,d,e,f){f.getUser();a.containerName="",a.containerDescription="",a.containerDockerfile="",a.containerVisible=!0,a.containerGit="",a.cmOption={lineNumbers:!0,indentWithTabs:!0,mode:"docker"},a.create_container=function(){return""==a.containerName?void(a.msg="Missing or empty name"):1==a.containerName.split("/").length?void(a.msg="Name must contain at least one '/' eg namespace/containername"):""==a.containerDescription?void(a.msg="Missing or empty description"):""==a.containerDockerfile&&""==a.containerGit?void(a.msg="Missing or empty Docker file or git repository, please fill one"):void d.get("/container/"+a.containerName).success(function(b){a.msg="Name already exists"}).error(function(b,c,d,f){404!=c?a.msg="Name already exists or cannot be used":e.create_new({},{name:a.containerName,description:a.containerDescription,dockerfile:a.containerDockerfile,visible:a.containerVisible,git:a.containerGit}).$promise.then(function(b){location.replace("#/container/"+a.containerName)},function(b){a.msg=b.statusText})})}}]).controller("containerCtrl",["$scope","$route","$routeParams","$document","$http","$location","Container","Config","Auth",function(a,b,c,d,e,f,g,h,i){a.container_id=c.path,a.tag="latest";var j=i.getUser();a.user=j,a.show_save=!1,a.newtag="",a.newterm="",a.addtag=function(b){""==b||a.container.meta.tags.indexOf(b)>=0||(a.container.meta.tags.push(b),a.show_save=!0)},a.addterm=function(b){""==b||a.container.meta.terms.indexOf(b)>=0||(a.container.meta.terms.push(b),a.show_save=!0)},a.add_member_push=function(b){""==b||a.container.acl_push.members.indexOf(b)>=0||(a.container.acl_push.members.push(b),a.container.acl_pull.members.push(b),a.show_save=!0)},a.add_member_pull=function(b){""==b||a.container.acl_pull.members.indexOf(b)>=0||(a.container.acl_pull.members.push(b),a.show_save=!0)},a.delete_tag=function(b){var c=a.container.meta.tags.indexOf(b);c>-1&&(a.container.meta.tags.splice(c,1),a.show_save=!0)},a.delete_term=function(b){var c=a.container.meta.terms.indexOf(b);c>-1&&(a.container.meta.terms.splice(c,1),a.show_save=!0)},a.delete_member_pull=function(b){var c=a.container.acl_pull.members.indexOf(b);c>-1&&(a.container.acl_pull.members.splice(c,1),a.show_save=!0)},a.delete_member_push=function(b){var c=a.container.acl_push.members.indexOf(b);c>-1&&(a.container.acl_push.members.splice(c,1),a.show_save=!0)},a.delete_container=function(){var b={method:"DELETE",url:"/container/"+a.container_id,headers:{"Content-Type":"application/json"}};e(b).success(function(a,b,c,d){f.path("/")})},a.proposesave=function(){a.show_save=!0},a.update_container=function(b){var c={method:"POST",url:"/container/"+a.container_id,headers:{"Content-Type":"application/json"},data:b};e(c).success(function(b,c,d,e){a.msg="Container updated",a.show_save=!1})},a.get_container=function(){e.get("/container/"+a.container_id).success(function(b){a.container=b,null==j&&(j={id:"anonymous"});var c={method:"POST",url:"/v2/token/",headers:{"Content-Type":"application/json"},params:{account:j.id,service:a.service,scope:"repository:"+a.container_id+":manifest"}};e(c).success(function(b,c,d,f){var g={method:"POST",url:"/container/manifest/"+a.container_id,headers:{"Content-Type":"application/json"},data:{token:b.token,tag:a.tag}};e(g).success(function(b,c,d,e){a.manifest=b});var h={method:"POST",url:"/container/tags/"+a.container_id,headers:{"Content-Type":"application/json"},data:{token:b.token}};e(h).success(function(b,c,d,e){a.tags=b.tags})})})},h.get().$promise.then(function(b){a.registry=b.registry,a.service=b.service,a.get_container()}),a.show_log=function(b){for(var c="",d=0;d<b.response.length;d++)c+="<div>"+b.response[d]+"</div>";a.dockerlog=c},a.go_to_dockerfile=function(){location.replace("#/dockerfile/"+a.container_id)}}]).controller("containerDockerFileCtrl",["$scope","$route","$routeParams","$document","$http","Container","Config",function(a,b,c,d,e,f,g){a.container_id=c.path,a.cmOption={lineNumbers:!0,indentWithTabs:!0,mode:"docker"},g.get().$promise.then(function(b){a.registry=b.registry,e.get("/container/"+a.container_id).success(function(b){a.container=b})}),a.go_to_info=function(){location.replace("#/container/"+a.container_id)},a.update_dockerfile=function(){var b={method:"POST",url:"/container/dockerfile/"+a.container_id,headers:{"Content-Type":"application/json"},data:{dockerfile:a.container.meta.Dockerfile,git:a.container.meta.git}};e(b).success(function(b,c,d,e){a.msg="New build requested after Dockerfile update"})}}]).controller("mycontainersCtrl",["$scope","$route","Container",function(a,b,c){c.query().$promise.then(function(b){a.containers=b}),a.show_container=function(a){location.replace("#/container/"+a.id)}}]).controller("allcontainersCtrl",["$scope","$route","Container",function(a,b,c){c.query_all().$promise.then(function(b){a.containers=b}),a.show_container=function(a){location.replace("#/container/"+a.id)}}]).controller("containersCtrl",["$scope","$route","$http","Container",function(a,b,c,d){a.selected=void 0,d.latest({},function(b){a.latest=b}),a.get_containers=function(a){return d.search({},{search:a}).$promise.then(function(a){return a.map(function(a){return a.id})})},a.select=function(b,d,e){c.get("/container/"+b).success(function(b){a.containers=[b]})},a.search=function(){d.search({},{search:a.selected}).$promise.then(function(b){a.containers=b})},a.show_container=function(a){location.replace("#/container/"+a.id)}}]).controller("TaskModalInstanceCtrl",["$scope","$modalInstance","items",function(a,b,c){a.selectedtask=c,a.convert_timestamp_to_date=function(a){if(""==a||null===a||void 0===a)return"";var b=new Date(1e3*a),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=b.getFullYear(),e=c[b.getMonth()],f=b.getDate(),g=b.getHours(),h=b.getMinutes(),i=b.getSeconds(),j=f+","+e+" "+d+" "+g+":"+h+":"+i;return j},a.ok=function(){},a.cancel=function(){b.dismiss("cancel")}}]).controller("usermngtCtrl",["$scope","$rootScope","$routeParams","$log","$location","$window","Auth",function(a,b,c,d,e,f,g){a.user=g.getUser()}]).controller("userCtrl",["$scope","$rootScope","$routeParams","$log","$location","$window","Auth","User",function(a,b,c,d,e,f,g,h){a.is_logged=!1,b.$on("loginCtrl.login",function(b,c){a.user=c,a.is_logged=!0,a.user.role&&"admin"==a.user.role&&(a.is_admin=!0)}),a.search=function(a){e.url("/search?q="+encodeURIComponent(a))},a.logout=function(){null!=f.sessionStorage&&delete f.sessionStorage.token,g.setUser(null),a.user=null,a.is_logged=!1,e.path("/login")},h.is_authenticated().$promise.then(function(b){null!==b&&void 0!==b.id&&(a.user=b,a.is_logged=!0,a.user.role&&"admin"==a.user.role&&(a.is_admin=!0),g.setUser(a.user))})}]).controller("loginCtrl",["$scope","$rootScope","$route","$location","$window","Auth","User",function(a,b,c,d,e,f,g){a.uid="",a.password="",a.authenticate=function(){g.authenticate({},{uid:a.uid,password:a.password}).$promise.then(function(c){var g=c.user;null!=e.sessionStorage&&(e.sessionStorage.token=c.token),void 0!==g.id?(f.setUser(g),b.$broadcast("loginCtrl.login",g),d.path("/")):a.msg="Could not authenticate!"},function(b){null!=e.sessionStorage&&delete e.sessionStorage.token,a.msg="Could not authenticate!"})}}]).service("Auth",function(){var a=null;return{getUser:function(){return a},setUser:function(b){a=b},isConnected:function(){return!!a}}});CodeMirror.defineMode("docker",function(){function a(a,b){for(var c=b.split(" "),d=0;d<c.length;d++)e[c[d]]=a}function b(a,b){if(a.eatSpace())return null;var g=a.sol(),h=a.next();if("\\"===h)return a.next(),null;if("'"===h||'"'===h||"`"===h)return b.tokens.unshift(c(h)),d(a,b);if("#"===h)return g&&a.eat("!")?(a.skipToEnd(),"meta"):(a.skipToEnd(),"comment");if("$"===h)return b.tokens.unshift(f),d(a,b);if("+"===h||"="===h)return"operator";if("-"===h)return a.eat("-"),a.eatWhile(/\w/),"attribute";if(/\d/.test(h)&&(a.eatWhile(/\d/),a.eol()||!/\w/.test(a.peek())))return"number";a.eatWhile(/[\w-]/);var i=a.current();return"="===a.peek()&&/\w+/.test(i)?"def":e.hasOwnProperty(i)?e[i]:null}function c(a){return function(b,c){for(var d,e=!1,g=!1;null!=(d=b.next());){if(d===a&&!g){e=!0;break}if("$"===d&&!g&&"'"!==a){g=!0,b.backUp(1),c.tokens.unshift(f);break}g=!g&&"\\"===d}return(e||!g)&&c.tokens.shift(),"`"===a||")"===a?"quote":"string"}}function d(a,c){return(c.tokens[0]||b)(a,c)}var e={};a("keyword","ADD CMD COPY ENTRYPOINT ENV EXPOSE FROM MAINTAINER ONBUILD RUN USER VOLUME WORKDIR");var f=function(a,b){b.tokens.length>1&&a.eat("$");var e=a.next(),f=/\w/;return"{"===e&&(f=/[^}]/),"("===e?(b.tokens[0]=c(")"),d(a,b)):(/\d/.test(e)||(a.eatWhile(f),a.eat("}")),b.tokens.shift(),"def")};return{startState:function(){return{tokens:[]}},token:function(a,b){return d(a,b)}}});